# apps/immich/base/server.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: immich-server
  namespace: immich
spec:
  replicas: 1
  selector: { matchLabels: { app: immich-server } }
  template:
    metadata: { labels: { app: immich-server } }
    spec:
      containers:
      - name: server
        image: ghcr.io/immich-app/immich-server:v1.132.0
        ports: [{ containerPort: 3001 }]
        envFrom:
        - configMapRef: { name: immich-env }
        - secretRef:  { name: immich-secrets }
        volumeMounts:
        - { name: upload,  mountPath: /usr/src/app/upload }
        - { name: library, mountPath: /usr/src/app/external, readOnly: true }
      volumes:
      - { name: upload,  persistentVolumeClaim: { claimName: upload } }
      - { name: library, persistentVolumeClaim: { claimName: library } }
